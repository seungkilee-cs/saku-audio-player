# Phase 1 · Step 2 — Audio Graph Utility

## Work Completed
- Created `src/utils/audio/peqGraph.js` with:
  - `BAND_LAYOUT` (10-band AutoEq-compatible map).
  - `createPeqChain(audioContext)` to build the preamp + filter chain and return `{ inputNode, outputNode, preampNode, filters }`.
  - `updatePeqFilters(filters, bands)` for in-place parameter updates without recreating nodes.
  - `updatePreamp(preampNode, gainDb)` converting dB offsets to linear gain.
  - `cleanupPeqChain(nodes)` to disconnect and cancel automation on all PEQ nodes.
- Ran `npm run lint` to ensure the new module meets existing code standards.

## Notes
- This utility is the backbone for wiring the Web Audio graph in Phase 1.3; separating node creation here keeps `AudioPlayer.jsx` lean and testable.
- `BAND_LAYOUT` aligns with the roadmap blueprint, ensuring preset schemas (Phase 2) and AutoEq imports (Phase 5) map directly to these filters.
- Default Q values (1.0 for peaking, ~0.707 for shelves) provide a neutral starting point; later presets will override as needed.
- Cleanup helper protects against memory leaks when switching tracks or tearing down the context, satisfying Phase 1 stability goals.

## Testing
- **Lint**: `npm run lint` (verified zero errors after adding `peqGraph.js`).
- **Manual chain smoke test** (optional for now):
  1. In DevTools console, create an `AudioContext`.
  2. Call `createPeqChain(audioContext)` and inspect `filters.length === 10`.
  3. Run `updatePeqFilters(chain.filters, [{ gain: 6, frequency: 80, Q: 1.2, type: "lowshelf" }])` and ensure the first filter reflects the changes.
  4. Invoke `cleanupPeqChain(chain)` and confirm nodes disconnect without throwing.

## Follow-up
- Phase 1.3 will integrate this utility into `AudioPlayer.jsx`, connecting `MediaElementSource → preamp → filters` and storing node references via the Phase 1.1 reducer helpers.
- Future presets/import workflows should rely on `BAND_LAYOUT` to ensure consistent band ordering.
