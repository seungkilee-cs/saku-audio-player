# Phase 1 · Step 1 — Context State Wiring

## Work Completed
- Added `initialPeqState` and `peqReducer()` to `src/context/PlaybackContext.jsx` to manage PEQ-specific state (enabled flag, bypass, bands, preamp, preset metadata, stored nodes).
- Introduced `useReducer` in the playback provider and exposed helper callbacks (`updatePeqBand`, `updateAllPeqBands`, `setPeqPreamp`, `togglePeqPreampAuto`, `togglePeqBypass`, `loadPeqPreset`, `storePeqNodes`, `setPeqEnabled`).
- Exported the PEQ state bundle via the provider so downstream components can access and mutate EQ data.

## Notes
- `peqReducer` defaults to no-ops when payload is missing or malformed to guard against unexpected dispatches.
- `peqBands` initialization remains empty; Phase 2 will populate it from `DEFAULT_PRESET` once the preset module is created.
- Existing playback functionality remains untouched; PEQ logic is additive and dormant until further phases connect the audio graph.
- Reducer pattern chosen because multiple components (panel UI, audio graph, preset importer) will need to coordinate updates to the same PEQ state; centralizing logic here prevents drift and makes future actions testable.
- Added actions (`UPDATE_BAND`, `LOAD_PRESET`, etc.) encapsulate domain rules such as auto-resetting `preampAuto` when loading a preset and guarding against invalid indices, keeping that logic out of view components.
- `peqNodes` reference storage gets introduced now so later phases (graph wiring) can reuse the same dispatcher instead of introducing separate context or refs.

## Testing
- **Lint**: `npm run lint` (ensures reducer + hooks integrations introduce no syntax/style errors).
- **Runtime smoke test**:
  1. `npm run dev`.
  2. Open React DevTools → select `PlaybackProvider` and confirm `value.peqState` exposes the expected keys (`peqEnabled`, `peqBypass`, `peqBands`, etc.).
  3. From DevTools Console, run inside the currently selected provider component:
     ```js
     $r.updatePeqBand(0, { gain: 3 });
     $r.togglePeqBypass();
     ```
     Verify `peqState.peqBands[0]` reflects the update and `peqState.peqBypass` toggles true/false.
- **Regression check**: Confirm playback controls (next/previous, load tracks) still function, demonstrating PEQ additions remain side-effect-free at this stage.

## Follow-up
- Phase 1.2 will implement `src/utils/audio/peqGraph.js`, using this state to build the actual Web Audio chain.
- Ensure upcoming components read from `peqState` rather than introducing separate PEQ state slices elsewhere.
